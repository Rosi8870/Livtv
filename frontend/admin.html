<!DOCTYPE html>
<html>
<head>
<title>Admin Panel ‚Äì Live TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { background:#05070c; color:#fff; font-family:system-ui }
.box { margin:16px; padding:16px; background:#111; border-radius:14px }
.row { display:flex; justify-content:space-between; margin:6px 0 }
button,input { padding:10px; margin:4px }
</style>
</head>

<body>

<div class="box" id="lock">
  <h2>üîê Admin PIN</h2>
  <input id="pin" type="password">
  <button onclick="unlock()">Unlock</button>
</div>

<div id="admin" style="display:none">

<div class="box">
  <h3>üìä Analytics</h3>
  <div id="stats"></div>
  <button onclick="resetAnalytics()">Reset Analytics</button>
</div>

<div class="box">
  <h3>üì∫ Channel Control</h3>
  <div id="channels">Loading‚Ä¶</div>
  <button onclick="resetDisabled()">Reset Disabled</button>
</div>

<div class="box">
  <h3>‚≠ê Favorites</h3>
  <div id="favorites"></div>
  <button onclick="clearFavorites()">Clear Favorites</button>
</div>

<div class="box">
  <h3>‚ö° System</h3>
  <button onclick="clearAll()">Clear ALL Data</button>
</div>

</div>

<script>
const API = "https://livtv.onrender.com/channels";
const PIN = localStorage.getItem("adminPin") || "1234";

let channels=[], disabled=[], favorites=[], analytics={};

function unlock(){
  if(document.getElementById("pin").value===PIN){
    document.getElementById("lock").style.display="none";
    document.getElementById("admin").style.display="block";
    load();
  } else alert("Wrong PIN");
}

function load(){
  disabled=JSON.parse(localStorage.getItem("disabledChannels")||"[]");
  favorites=JSON.parse(localStorage.getItem("favorites")||"[]");
  analytics=JSON.parse(localStorage.getItem("analytics")||"{}");

  fetch(API).then(r=>r.json()).then(d=>{
    channels=d;
    render();
  });
}

function render(){
  renderStats();
  renderChannels();
  renderFavorites();
}

function renderStats(){
  document.getElementById("stats").innerHTML=`
    <div>Total Plays: ${analytics.total||0}</div>
    <div>Last Played: ${analytics.lastPlayed||"-"}</div>
    <div>${analytics.lastTime||""}</div>
  `;
}

function renderChannels(){
  const el=document.getElementById("channels");
  el.innerHTML="";
  channels.forEach(c=>{
    const dis=disabled.includes(c.url);
    el.innerHTML+=`
      <div class="row">
        <span>${c.name}</span>
        <button onclick="toggle('${c.url}')">${dis?"Enable":"Disable"}</button>
      </div>`;
  });
}

function renderFavorites(){
  const el=document.getElementById("favorites");
  el.innerHTML="";
  favorites.forEach(f=>{
    el.innerHTML+=`
      <div class="row">
        <span>${f}</span>
        <button onclick="removeFav('${f}')">Remove</button>
      </div>`;
  });
}

function toggle(url){
  disabled = disabled.includes(url)
    ? disabled.filter(u=>u!==url)
    : [...disabled,url];
  localStorage.setItem("disabledChannels",JSON.stringify(disabled));
  renderChannels();
}

function removeFav(url){
  favorites=favorites.filter(f=>f!==url);
  localStorage.setItem("favorites",JSON.stringify(favorites));
  renderFavorites();
}

function clearFavorites(){
  localStorage.removeItem("favorites");
  favorites=[];
  renderFavorites();
}

function resetAnalytics(){
  localStorage.removeItem("analytics");
  analytics={};
  renderStats();
}

function resetDisabled(){
  localStorage.removeItem("disabledChannels");
  disabled=[];
  renderChannels();
}

function clearAll(){
  if(confirm("Clear ALL data?")){
    localStorage.clear();
    location.reload();
  }
}
</script>

</body>
</html>
