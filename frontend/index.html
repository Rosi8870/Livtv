<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live TV Player</title>

<style>
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: system-ui;
  background: radial-gradient(circle at top, #1b2a3a, #05070c 70%);
  color: #fff;
}
.glass {
  background: rgba(255,255,255,0.10);
  backdrop-filter: blur(18px);
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,0.15);
  box-shadow: 0 12px 45px rgba(0,0,0,0.45);
}
header {
  margin: 16px;
  padding: 18px;
  text-align: center;
  font-size: 22px;
  font-weight: 600;
}
#searchBox {
  margin: 0 16px 14px;
  padding: 14px;
}
#search {
  width: 100%;
  padding: 16px;
  border-radius: 14px;
  border: none;
  background: rgba(255,255,255,0.15);
  color: #fff;
}
#layout {
  display: flex;
  gap: 16px;
  height: calc(100vh - 220px);
  padding: 0 16px;
}
#channels {
  width: 34%;
  overflow-y: auto;
  padding: 8px;
  scrollbar-width: none;
}
#channels::-webkit-scrollbar { display: none; }

.skeleton {
  height: 56px;
  margin-bottom: 12px;
  border-radius: 14px;
  background: linear-gradient(
    90deg,
    rgba(255,255,255,0.08) 25%,
    rgba(255,255,255,0.18) 37%,
    rgba(255,255,255,0.08) 63%
  );
  background-size: 400% 100%;
  animation: shimmer 1.4s infinite;
}
@keyframes shimmer {
  0% { background-position: 100% 0; }
  100% { background-position: -100% 0; }
}

.channel {
  display: flex;
  justify-content: space-between;
  padding: 16px 18px;
  margin-bottom: 12px;
  border-radius: 16px;
  background: rgba(255,255,255,0.08);
  cursor: pointer;
  transition: .3s;
}
.channel:hover {
  background: rgba(255,255,255,0.16);
  transform: translateY(-4px);
}
.star { cursor: pointer; }

#playerBox {
  flex: 1;
  position: relative;
  padding: 14px;
}
video {
  width: 100%;
  height: 100%;
  border-radius: 18px;
  background: black;
}
video::-webkit-media-controls-timeline,
video::-webkit-media-controls-current-time-display,
video::-webkit-media-controls-time-remaining-display {
  display: none !important;
}
#playerSkeleton {
  position: absolute;
  inset: 14px;
  border-radius: 18px;
  background: linear-gradient(
    90deg,
    rgba(255,255,255,0.08) 25%,
    rgba(255,255,255,0.18) 37%,
    rgba(255,255,255,0.08) 63%
  );
  background-size: 400% 100%;
  animation: shimmer 1.4s infinite;
  display: none;
}

@media (max-width: 900px) {
  #layout { flex-direction: column; height: auto; }
  #playerBox { height: 38vh; }
  #channels { width: 100%; max-height: 52vh; }
}
</style>
</head>

<body>

<header class="glass">üì∫ Live TV Player</header>

<div id="searchBox" class="glass">
  <input id="search" placeholder="Search channels...">
</div>

<div id="layout">
  <div id="channels" class="glass">
    <div class="skeleton"></div>
    <div class="skeleton"></div>
    <div class="skeleton"></div>
  </div>

  <div id="playerBox" class="glass">
    <div id="playerSkeleton"></div>
    <video id="player" controls playsinline></video>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
/* ‚úÖ CONNECTED TO YOUR RENDER BACKEND */
const API = "https://livtv.onrender.com/channels";

const channelsEl = document.getElementById("channels");
const searchInput = document.getElementById("search");
const video = document.getElementById("player");
const playerSkeleton = document.getElementById("playerSkeleton");

let channels = [];
let hls;

let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
let disabled = JSON.parse(localStorage.getItem("disabledChannels") || "[]");
let analytics = JSON.parse(localStorage.getItem("analytics") || "{}");
let lastChannel = localStorage.getItem("lastChannel");

fetch(API)
  .then(r => r.json())
  .then(data => {
    channels = data;
    render();
    if (lastChannel) {
      const ch = channels.find(c => c.url === lastChannel);
      if (ch && !disabled.includes(ch.url)) play(ch);
    }
  });

function render() {
  channelsEl.innerHTML = "";
  const q = searchInput.value.toLowerCase();
  channels
    .filter(c => !disabled.includes(c.url))
    .filter(c => c.name.toLowerCase().includes(q))
    .forEach(c => {
      const fav = favorites.includes(c.url);
      const div = document.createElement("div");
      div.className = "channel";
      div.innerHTML = `<span>${c.name}</span><span class="star">${fav?"‚≠ê":"‚òÜ"}</span>`;
      div.onclick = () => play(c);
      div.querySelector(".star").onclick = e => {
        e.stopPropagation();
        toggleFav(c.url);
      };
      channelsEl.appendChild(div);
    });
}

function play(channel) {
  localStorage.setItem("lastChannel", channel.url);
  playerSkeleton.style.display = "block";
  if (hls) hls.destroy();

  if (Hls.isSupported()) {
    hls = new Hls();
    hls.loadSource(channel.url);
    hls.attachMedia(video);
    hls.on(Hls.Events.FRAG_LOADED, () => {
      playerSkeleton.style.display = "none";
      video.play().catch(()=>{});
      recordAnalytics(channel.name);
    });
  } else {
    video.src = channel.url;
    video.onloadeddata = () => {
      playerSkeleton.style.display = "none";
      recordAnalytics(channel.name);
      video.play();
    };
  }
}

function toggleFav(url) {
  favorites = favorites.includes(url)
    ? favorites.filter(f => f !== url)
    : [...favorites, url];
  localStorage.setItem("favorites", JSON.stringify(favorites));
  render();
}

function recordAnalytics(name) {
  analytics.total = (analytics.total || 0) + 1;
  analytics[name] = (analytics[name] || 0) + 1;
  analytics.lastPlayed = name;
  analytics.lastTime = new Date().toLocaleString();
  localStorage.setItem("analytics", JSON.stringify(analytics));
}

searchInput.oninput = render;
</script>

</body>
</html>
